
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width" initial-scale="1.0" />
  <title>Umar Task Timer</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0;}
    h1 { color: #333;}
    input, button { margin: 5px; padding: 8px;}
.task {
      background: #e0ffe0;
      padding: 10px;
      margin: 10px 0;
      border-left: 5px solid #007BFF;
      transition: background 0.3s;
      position: relative;
}
.task.soon { background: #ffe0e0; border-left-color: red;}
.task.expired { background: #cccccc; border-left-color: gray;}
.flag { position: absolute; top: 10px; right: 10px; font-size: 20px; color: green;}
.controls button { margin-right: 5px;border:0;}
  .del{
    background-color:red;
    color:white;
  }
  </style>
</head>
<body>
  <h1>‚è∞ Task Timer</h1>
  <input type="text" id="taskName" placeholder="Task name">
  <input type="datetime-local" id="taskTime">
  <button onclick="addTask()">Add Task</button>
  <button onclick="stopAlarm()">Stop Alarm</button>
  <div id="taskList"></div>

  <!-- Loud alarm sound -->
  <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto" loop></audio>

  <script>
    const taskList = document.getElementById('taskList');
    const alarm = document.getElementById('alarmSound');
    let tasks = [];
    let vibrationInterval = null;
    let activeAlarm = null;

    // Request notification permission
    if ("Notification" in window && Notification.permission!== "granted") {
      Notification.requestPermission();
}

    window.onload = () => {
      const saved = localStorage.getItem('tasks');
      if (saved) {
        tasks = JSON.parse(saved);
        renderTasks();
}
};

    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
}

    function addTask() {
      const name = document.getElementById('taskName').value.trim();
      const timeStr = document.getElementById('taskTime').value;
      const endTime = new Date(timeStr).getTime();
      if (!name || isNaN(endTime)) return alert("Enter valid task and time");

      tasks.push({ name, endTime, expired: false});
      saveTasks();
      renderTasks();
}

    function formatTime(ms) {
      const totalSecs = Math.floor(ms / 1000);
      const hrs = Math.floor(totalSecs / 3600);
      const mins = Math.floor((totalSecs % 3600) / 60);
      const secs = totalSecs % 60;
      return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

    function renderTasks() {
      taskList.innerHTML = '';
      tasks.forEach((task, index) => {
        const remaining = task.endTime - Date.now();
        const div = document.createElement('div');
        div.className = 'task';

        if (task.expired) {
          div.classList.add('expired');
          div.innerHTML += `<div class="flag">‚úÖ</div>`;
} else if (remaining <= 20000) {
          div.classList.add('soon');
}

        const deadline = new Date(task.endTime).toLocaleString();
        div.innerHTML += `<strong>${task.name}</strong><br>
                          Deadline: ${deadline}<br>
                          Time left: ${task.expired? 'Expired': formatTime(remaining)}
                          <div class="controls">
                            <button onclick="editTask(${index})">‚úèÔ∏è Edit</button>
                            <button class="del" onclick="deleteTask(${index})">üóëÔ∏è Delete</button>
                            ${task.expired? `<button onclick="snoozeTask(${index})">üò¥ Snooze</button>`: ''}
  </div>`;
        taskList.appendChild(div);
});
}

    function editTask(index) {
      const task = tasks[index];
      const newName = prompt("Edit task name:", task.name);
      const newTime = prompt("Edit deadline (YYYY-MM-DD HH:MM:SS):", new Date(task.endTime).toISOString().slice(0, 19).replace("T", " "));
      if (newName && newTime) {
        task.name = newName;
        task.endTime = new Date(newTime.replace(" ", "T")).getTime();
        task.expired = false;
        saveTasks();
        renderTasks();
}
}

    function deleteTask(index) {
      tasks.splice(index, 1);
      saveTasks();
      renderTasks();
}

    function snoozeTask(index) {
      tasks[index].endTime = Date.now() + 5 * 60000;
      tasks[index].expired = false;
      stopAlarm();
      saveTasks();
      renderTasks();
}

    function stopAlarm() {
      if (activeAlarm) {
        activeAlarm.pause();
        activeAlarm.currentTime = 0;
        activeAlarm = null;
}
      if (vibrationInterval) {
        clearInterval(vibrationInterval);
        vibrationInterval = null;
}
}

    function triggerAlarm(taskName) {
      activeAlarm = alarm;
      alarm.volume = 1.0;
      alarm.play();

      if ("Notification" in window && Notification.permission === "granted") {
        new Notification("‚è∞ Task Expired", { body: `${taskName} is due!`});
}

      if (navigator.vibrate) {
        vibrationInterval = setInterval(() => navigator.vibrate([500, 500]), 1000);
}
}

    setInterval(() => {
      tasks.forEach(task => {
        if (!task.expired && Date.now()>= task.endTime) {
          task.expired = true;
          triggerAlarm(task.name);
          saveTasks();
}
});
      renderTasks();
}, 1000);

    document.addEventListener('click', () => {
      alarm.volume = 1.0;
}, { once: true});
  </script>
</body>
</html>
